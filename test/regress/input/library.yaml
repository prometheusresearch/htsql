#
# Copyright (c) 2006-2011, Prometheus Research, LLC
# Authors: Clark C. Evans <cce@clarkevans.com>,
#          Kirill Simonov <xi@resolvent.net>
#

title: Standard Data Types, Functions, and Operations
id: library
tests:

########################################################################

- title: Literals
  tests:

  # Untyped literals, implicitly converted to string
  - uri: /{null(), '', 'HTSQL'}

  # Boolean values
  - uri: /{true(), false()}
  - uri: /{boolean('true'), boolean('false')}
  # Invalid Boolean literals
  - uri: /boolean('')
    expect: 400
  - uri: /boolean('yes')
    expect: 400

  # String values
  - uri: /{'', 'HTSQL', 'O''Reilly',
           '%ce%bb%cf%8c%ce%b3%ce%bf%cf%82',
           '$-b \pm \sqrt{b^2 - 4ac} \over 2a$'}
    ifndef: mssql
  # The regression database for MS SQL Server uses Latin1 locale and therefore
  # is unable to represent greek characters.
  - uri: /{'', 'HTSQL', 'O''Reilly', 'zo%c3%b6logy',
           '$-b \pm \sqrt{b^2 - 4ac} \over 2a$'}
    ifdef: mssql
  - uri: /{string('832040')}

  # Integer values
  - uri: /{0, 7, -97, 3571}
  - uri: /{integer('4862'), integer('-9694845')}
  # 64-bit signed integers
  - uri: /{integer('-9223372036854775808'),
           integer('9223372036854775807')}
  # Invalid integer literal
  - uri: /{integer('2.5e1')}
    expect: 400
  # Out of range
  - uri: /{18446744073709551616}
    expect: 400
    ifndef: oracle
  # Oracle does not have a range limitation for the `INTEGER` data type.
  - uri: /{18446744073709551616, 340282366920938463463374607431768211456}
    ifdef: oracle

  # Decimal values
  - uri: /{1.0, -2.5, 0.875}
  - uri: /{decimal('1E-10')}
  # Arbitrary length
  - uri: /{4154781481226426191177580544000000.808017424794512875886459904961710757005754368000000000}
    ifndef: mssql
  # Invalid decimal literals
  - uri: /{decimal('vingt-cinq')}
    expect: 400

  # Float values
  - uri: /{0e0, -57721e-5, 36288e2}
  - uri: /{float('2147483647')}
  # Invalid float literal
  - uri: /float('vingt-cinq')
    expect: 400
  # Infinity
  - uri: /{1e1024}
    expect: 400
  - uri: /{float('inf')}
    expect: 400

  # Date values
  - uri: /{date('2010-04-15')}
  # Invalid date
  - uri: /date('2010-13-07')
    expect: 400

  # Time values
  - uri: /{time('20:13'), time('20:13:04.5')}
  # Invalid time
  - uri: /{time('29:04')}
    expect: 400

  # Datetime values
  - uri: /{datetime('2010-04-15'), datetime('2010-04-15 20:13'),
           datetime('2010-04-15T20:13:04.5'),
           datetime('2010-04-15 20:13:04.5 -0400')}
  # Invalid Datetime value
  - uri: /{datetime('2010-13-07 17:43')}
    expect: 400
  - uri: /{datetime('2010-06-05 29:04')}
    expect: 400

########################################################################

- title: Logical and Comparison Operators
  tests:

  # Boolean literals
  - uri: /{true(), false()}
  # Boolean conversion
  - uri: /{boolean(null()), boolean('true'), boolean('false')}
  - uri: /{boolean(integer(null())), boolean(0.0), boolean(1e0)}
  - uri: /{boolean(string(null())),
           boolean(string('')),
           boolean(string('FALSE'))}
  - uri: /{boolean(date(null())), boolean(date('2010-04-15'))}
  # AND, OR, NOT
  - uri: /{true()&true(), true()&false(), false()&true(), false()&false()}
  - uri: /{true()|true(), true()|false(), false()|true(), false()|false()}
  - uri: /{!true(), !false()}
  - uri: /{null()&true(), null()&false(), null()&null()}
  - uri: /{null()|true(), null()|false(), null()|null()}
  - uri: /{!null()}
  # Is NULL
  - uri: /{is_null(null()), is_null('NULL'), is_null(0)}

  # Equality
  - uri: /{true()=true(), 1=1, 'HTSQL'='HTSQL'}
  - uri: /{date('2010-04-15')=date('2010-04-15'),
           time('20:13')=time('20:13'),
           datetime('2010-04-15 20:13')=datetime('2010-04-15 20:13')}
  - uri: /{true()!=false(), 1!=0, 'HTSQL'!='PITA'}
  - uri: /{date('2010-04-15')!=date('1991-08-20'),
           time('20:13')!=time('02:01'),
           datetime('2010-04-15 20:13')!=datetime('1991-08-20 02:01')}
  - uri: /{true()!=true(), 1!=1, 'HTSQL'!='HTSQL'}
  - uri: /{date('2010-04-15')!=date('2010-04-15'),
           time('20:13')!=time('20:13'),
           datetime('2010-04-15 20:13')!=datetime('2010-04-15 20:13')}
  - uri: /{true()=false(), 1=0, 'HTSQL'='PITA'}
  - uri: /{date('2010-04-15')=date('1991-08-20'),
           time('20:13')=time('02:01'),
           datetime('2010-04-15 20:13')=datetime('1991-08-20 02:01')}
  # IN
  - uri: /{5={2,3,5,7}, 'HTSQL'!={'ISBL','SQUARE','QUEL'}}
  - uri: /{5!={2,3,5,7}, 'HTSQL'={'ISBL','SQUARE','QUEL'}}
  # NULL and Total Equality
  - uri: /{1=null(), 1!=null(), null()=null(), null()!=null()}
  - uri: /{false()={false(),null()}, true()={false(),null()},
           false()!={false(),null()}, false()!={true(),null()}}
  - uri: /{null()={true(),false()}, null()!={true(),false()}}
  - uri: /{1==1, 1!==0, 1==null(), 1!==null(),
           null()==null(), null()!==null()}
  # Coercion
  - uri: /{7=0.7e1, '13'=13.0, '13'!=='13.0'}
  # Inadmissible operands
  - uri: /{true()=1}
    expect: 400
  - uri: /{'cinq'!=4.9}
    expect: 400
  - uri: /{date('2010-04-15')==1991}
    expect: 400
  - uri: /{date('2010-04-15')=datetime('2010-04-15')}
    expect: 400
  - uri: /{datetime('2010-04-15 20:13')!==time('02:01')}
    expect: 400

  # Comparison
  - uri: /{1<10, 7.0<=7.0, 'omega'>'alpha'}
  - uri: /{date('2010-04-15')>=date('1991-08-20'),
           time('02:01')<time('20:13'),
           datetime('2010-04-15 20:13')>datetime('1991-08-20 02:01')}
  - uri: /{1>=10, 7.0>7.0, 'omega'<='alpha'}
  - uri: /{date('2010-04-15')<date('1991-08-20'),
           time('02:01')>=time('20:13'),
           datetime('2010-04-15 20:13')<=datetime('1991-08-20 02:01')}
  # NULL
  - uri: /{0<null(), ''>null(), null()>=null()}
  # Coercion
  - uri: /{175e-2>'875e-3', '2010-04-15'>=date('1991-08-20')}
  # Inadmissible operands
  - uri: /{false()<true()}
    expect: 400
  - uri: /{'cinq'>4.9}
    expect: 400
  - uri: /{date('2010-04-15')>=1991}
    expect: 400
  - uri: /{datetime('2010-04-15 20:13')>time('02:01')}
    expect: 400

  # If NULL and NULL If
  - uri: /{if_null('Victor', 'William'),
           if_null(null(), 'William'),
           if_null('Victor', null()),
           if_null(null(), null())}
  - uri: /{null_if('George', 'George'),
           null_if('George', 'Harry'),
           null_if(null(),  'Harry'),
           null_if('George', null()),
           null_if(null(), null())}
  # Coercion
  - uri: /{if_null(1, 0.1e1), null_if(1, 0.1e1)}
  # Inadmissible operands
  - uri: /{if_null('cinq', 5)}
    expect: 400
  - uri: /{null_if('cinq', 5)}
    expect: 400
  - uri: /{if_null(date('2010-04-15'),1991)}
    expect: 400
  - uri: /{null_if(datetime('2010-04-15 20:13'),time('02:01'))}
    expect: 400

  # If and Switch
  - uri: /{if(true(), 'then'),
           if(false(), 'then'),
           if(null(), 'then')}
  - uri: /{if(true(), 'then', 'else'),
           if(false(), 'then', 'else'),
           if(null(), 'then', 'else')}
  - uri: /{if(7=0, 'none', 7=1, 'one', 7=2, 'two', 'many')}
  - uri: /{switch(1, 1, 'George', 2, 'Harry'),
           switch(2, 1, 'George', 2, 'Harry'),
           switch(3, 1, 'George', 2, 'Harry')}
  - uri: /{switch(1, 1, 'George', 2, 'Harry', 'Edward'),
           switch(2, 1, 'George', 2, 'Harry', 'Edward'),
           switch(3, 1, 'George', 2, 'Harry', 'Edward')}
  # Coercion
  - uri: /{if(true(), 1, 0e0)}
  - uri: /{switch(date('2010-04-15'),
                  '1991-08-20', 'WWW',
                  '2010-04-15', 'HTSQL')}
  # Inadmissible operands
  - uri: /{if('', 'then', 'else')}
    expect: 400
  - uri: /{switch(1, date('2010-04-15'), 1, date('1991-08-20'), 2)}
    expect: 400
  - uri: /{switch(1, 1, 'George', 2, false())}
    expect: 400

########################################################################

- title: Numeric Functions and Operators
  tests:

  # Conversion
  - uri: /{integer(null()), integer('60'), integer(60)}
  - uri: /{decimal(null()), decimal('2.125'), decimal(2.125)}
  - uri: /{float(null()), float('271828e-5'), float('271828e-5')}
  - uri: /{integer(2.125), integer(271828e-5)}
  - uri: /{decimal(60), decimal(271828e-5)}
  - uri: /{float(60), float(2.125)}
  - uri: /{integer(string('60'))}
  - uri: /{decimal(string('2.125'))}
  - uri: /{float(string('271828e-5'))}
  # Inadmissible operand
  - uri: /{integer('cinq')}
    expect: 400
  - uri: /{decimal(true())}
    expect: 400
  - uri: /{float(date('2010-04-15'))}
    expect: 400
  # Not a number
  - uri: /{integer(string('zero'))}
    ifdef: [sqlite, mysql]
  - uri: /{float(string('zero'))}
    ifdef: [sqlite, mysql]
  - uri: /{integer(string('cinq'))}
    expect: 409
    ignore: true
    ifndef: [sqlite, mysql]
  # Integer overflow
  - uri: /{integer(4294967296.0)}
    expect: 409
    ignore: true
    ifdef: [pgsql, mssql]
  - uri: /{integer(1.8446744073709552e+19)}
    expect: 409
    ignore: true
    ifdef: [pgsql, mssql]
  - uri: /{integer(4294967296.0),
           integer(1.8446744073709552e+19)}
    ifndef: [pgsql, mssql]

  # Arithmetics
  - uri: /{+7, -7, +2.125, -2.125, +271828e-5, -271828e-5}
  - uri: /{7920+9504, 7.25+0.875, 120205e-5+57721e-5}
  - uri: /{7920-9504, 7.25-0.875, 120205e-5-57721e-5}
  - uri: /{7920*9504, 7.25*0.875, 120205e-5*57721e-5}
  - uri: /{7920/9504, 7.25/0.875, 120205e-5/57721e-5}
  # Coercion
  - uri: /{7+2.125, 7+271828e-5, 2.125+271828e-5}
  - uri: /{7-2.125, 7-271828e-5, 2.125-271828e-5}
  - uri: /{7*2.125, 7*271828e-5, 2.125*271828e-5}
  - uri: /{7/2.125, 7/271828e-5, 2.125/271828e-5}
  # Inadmissible operands
  - uri: /{'cinq'+7}
    expect: 400
  - uri: /{2.125-date('2010-04-15')}
    expect: 400
  - uri: /{true()/271828e-5}
    expect: 400
  # Integer overflow
  - uri: /{7*2147483647}
    expect: 409
    ignore: true
    ifdef: [pgsql, mssql]
  - uri: /{9223372036854775807+1}
    expect: 409
    ignore: true
    ifdef: [pgsql, mssql]
  - uri: /{7*2147483647, 9223372036854775807+1}
    ifndef: [pgsql, mssql]
  # Division by zero
  - uri: /{7/0}
    expect: 409
    ignore: true
    ifndef: [sqlite, mysql]
  - uri: /{7/0.0}
    expect: 409
    ignore: true
    ifndef: [sqlite, mysql]
  - uri: /{7/0e0}
    expect: 409
    ignore: true
    ifndef: [sqlite, mysql, oracle]
  - uri: /{7/0, 7/0.0, 7/0e0}
    ifdef: [sqlite, mysql]
  - uri: /{0e0/0e0, 7/0e0}
    ifdef: [oracle]

  # Rounding
  - uri: /{round(3272.78125,2)}
  - uri: /{round(3272.78125,-2)}
    ifndef: sqlite
  - uri: /{round(3272.78125), round(271828e-5)}
  # Coercion
  - uri: /{round(9973)}
  # Bug in MSSQL 2008R2, see
  # https://connect.microsoft.com/SQLServer/feedback/details/646516/bad-example-for-round
  - uri: /{round(9973,-2)}
    ifndef: [sqlite, mssql]
  # Inadmissible operand
  - uri: /{round(271828e-5,2)}
    expect: 400
    ifndef: sqlite

########################################################################

- title: String Functions and Operators
  tests:

  # Conversion
  - uri: /{string(null()), string('OMGWTFBBQ')}
  - uri: /{string(true()), string(false())}
  - uri: /{string(60), string(2.125), string(-57721e-5)}
  - uri: /{string(date('2010-04-15'))}
  - uri: /{string(time('20:13'))}
  - uri: /{string(datetime('2010-04-15 20:13'))}

  # Length
  - uri: /{length(''), length('OMGWTFBBQ')}
  - uri: /{length(null())}
  # Inadmissible operand
  - uri: /{length(date(2010-04-15))}
    expect: 400

  # Concatenation
  - uri: /{'OMG'+'WTF'+'BBQ'}
  - uri: /{null()+'LOL', 'LOL'+null(),
           string(null())+string(null())}
  # Inadmissible operands
  - uri: /{string('LOL')+7}
    expect: 400

  # Contains
  - uri: /{'OMGWTFBBQ'~'wtf', 'OMGWTFBBQ'!~'LOL'}
  - uri: /{'OMGWTFBBQ'!~'wtf', 'OMGWTFBBQ'~'LOL'}
  # Bug in MSSQL 2005, `SELECT (CASE WHEN ('LOL' LIKE NULL) THEN 1 END)`
  # generates [<1>].
  - uri: /{null()~'LOL', 'LOL'~null(), null()~null()}
    ifndef: mssql
  - uri: /{null()~'LOL', null()~null()}
    ifdef: mssql
  - uri: /this(){true()}?'LOL'~null()
    ifdef: mssql

  # Slicing
  - uri: /{head('OMGWTFBBQ'), head('OMGWTFBBQ',3), head('OMGWTFBBQ',-3)}
  - uri: /{tail('OMGWTFBBQ'), tail('OMGWTFBBQ',3), tail('OMGWTFBBQ',-3)}
  - uri: /{head('OMGWTFBBQ',0), tail('OMGWTFBBQ',0)}
  - uri: /{head(null()), tail(null()),
           head('OMGWTFBBQ',null()), tail('OMGWTFBBQ',null())}
  - uri: /{slice('OMGWTFBBQ',3,6), slice('OMGWTFBBQ',3,-3),
           slice('OMGWTFBBQ',-6,6), slice('OMGWTFBBQ',-6,-3)}
  - uri: /{slice('OMGWTFBBQ',0,0), slice('OMGWTFBBQ',6,3),
           slice('OMGWTFBBQ',10,13), slice('OMGWTFBBQ',-3,-6)}
  - uri: /{slice(null(),3,-3), slice('OMGWTGBBQ',null(),null()),
           slice('OMGWTFBBQ',-3,null()), slice('OMGWTFBBQ',null(),3)}
  - uri: /{at('OMGWTFBBQ',0), at('OMGWTFBBQ',3), at('OMGWTFBBQ',-3)}
  - uri: /{at('OMGWTFBBQ',3,3), at('OMGWTFBBQ',6,-3),
           at('OMGWTFBBQ',-3,3), at('OMGWTFBBQ',-12,6)}
  - uri: /{at('OMGWTFBBQ',10), at('OMGWTFBBQ',0,-3)}
  - uri: /{at(null(),3), at('OMGWTFBBQ',null(),3), at('OMGWTFBBQ',3,null())}

  # Transformations
  - uri: /{upper('lol'), lower('LOL')}
  - uri: /{trim('  LOL  '), ltrim('  LOL  '), rtrim('  LOL  ')}
  - uri: /{replace('OMGWTFBBQ','WTF','LOL')}
  - uri: /{replace('OMGWTFBBQ','wtf','LOL'),
           replace('OMGWTFBBQ','WTF','lol')}
    ifndef: [mssql, oracle]
  # `REPLACE` in MSSQL respects the database collation, which is
  # case-insensitive for the regression database.  Same with Oracle
  # when `NLS_SORT = BINARY_CI` and `NLS_COMP = LINGUISTIC`.
  - uri: /{replace('OMGWTFBBQ','wtf','LOL')}
    ifdef: [mssql, oracle]
  - uri: /{replace('OMGWTFBBQ','WTF','lol')}
    ifdef: [mssql, oracle]
  - uri: /{replace('floccinaucinihilipilification','ili','LOL')}
  - uri: /{replace('OMGWTFBBQ','','LOL'),
           replace('OMGWTFBBQ','WTF','')}
  - uri: /{replace(null(),'WTF','LOL'),
           replace('OMGWTFBBQ',null(),'LOL'),
           replace('OMGWTFBBQ','WTF',null())}

########################################################################

- title: Date Functions and Operators
  tests:

  # Conversion
  - uri: /{date(null()), date('2010-04-15')}
  - uri: /{date(string('2010-04-15'))}
  - uri: /{date(datetime('2010-04-15 20:13'))}
  # Inadmissible operand
  - uri: /{date('2010-13-07')}
    expect: 400
  - uri: /{date(true())}
    expect: 400
  - uri: /{date(7)}
    expect: 400
  - uri: /{date(time('20:13'))}
    expect: 400
  # Not a date
  - uri: /{date(string('birthday'))}
    expect: 409
    ignore: true
    ifndef: [sqlite, mysql]
  - uri: /{date(string('2010-13-07'))}
    expect: 409
    ignore: true
    ifndef: [sqlite, mysql]
  - uri: /{date(string('birthday')),
           date(string('2010-13-07'))}
    ifdef: [sqlite, mysql]

  # Construction
  - uri: /{today()}
    ignore: true
  - uri: /{date(2010,4,15), date(2010,3,46), date(2011,-8,15)}

  # Components
  - uri: /{year(date('2010-04-15')),
           month(date('2010-04-15')),
           day(date('2010-04-15'))}

  # Arithmetics 
  - uri: /{date('1991-08-20')+6813,
           date('2010-04-15')-6813,
           date('2010-04-15')-date('1991-08-20')}

########################################################################

- title: Time Functions and Operators
  tests:

  # Conversion
  - uri: /{time(null()), time('20:13')}
  - uri: /{time(string('20:13'))}
    ifndef: oracle
  - uri: /{time(string('20:13:00'))}
    ifdef: oracle
  - uri: /{time(datetime('2010-04-15 20:13'))}
  # Inadmissible operand
  - uri: /{time('29:04')}
    expect: 400
  - uri: /{time(true())}
    expect: 400
  - uri: /{time(7)}
    expect: 400
  - uri: /{time(date('2010-04-15'))}
    expect: 400
  # Not a datetime value
  - uri: /{time(string('just a moment ago'))}
    expect: 409
    ignore: true
    ifndef: [sqlite, mysql]
  - uri: /{time(string('29:04'))}
    expect: 409
    ignore: true
    ifndef: [sqlite, mysql]
  - uri: /{time(string('just a moment ago')),
           time(string('29:04'))}
    ifdef: [sqlite, mysql]

  # Components
  - uri: /{hour(time('20:13:04.5')),
           minute(time('20:13:04.5')),
           second(time('20:13:04.5'))}

########################################################################

- title: DateTime Functions and Operators
  tests:

  # Conversion
  - uri: /{datetime(null()), datetime('2010-04-15 20:13')}
  - uri: /{datetime(string('2010-04-15 20:13'))}
    ifndef: oracle
  - uri: /{datetime(string('2010-04-15 20:13:00'))}
    ifdef: oracle
  - uri: /{datetime(date('2010-04-15'))}
  # Inadmissible operand
  - uri: /{datetime('2010-13-07 17:43')}
    expect: 400
  - uri: /{datetime(true())}
    expect: 400
  - uri: /{datetime(7)}
    expect: 400
  - uri: /{datetime(time('20:13'))}
    expect: 400
  # Not a datetime value
  - uri: /{datetime(string('just a moment ago'))}
    expect: 409
    ignore: true
    ifndef: [sqlite, mysql]
  - uri: /{datetime(string('2010-13-07 17:43'))}
    expect: 409
    ignore: true
    ifndef: [sqlite, mysql]
  - uri: /{datetime(string('just a moment ago')),
           datetime(string('2010-13-07 17:43'))}
    ifdef: [sqlite, mysql]

  # Construction
  - uri: /{now()}
    ignore: true
  - uri: /{datetime(2010,4,15), datetime(2010,4,15,20,13),
           datetime(2010,4,15,20,13,4.5)}
  - uri: /{datetime(2010,3,46,25,-289,124.5)}
  - uri: /{datetime(date('2010-04-15'),time('20:13'))}

  # Components
  - uri: /{year(datetime('2010-04-15 20:13:04.5')),
           month(datetime('2010-04-15 20:13:04.5')),
           day(datetime('2010-04-15 20:13:04.5'))}
  - uri: /{hour(datetime('2010-04-15 20:13:04.5')),
           minute(datetime('2010-04-15 20:13:04.5')),
           second(datetime('2010-04-15 20:13:04.5'))}

  # Arithmetics
  - uri: /{datetime('1991-08-20 02:01')+6813.7583854166667,
           datetime('2010-04-15 20:13:04.5')-6813.7583854166667}

########################################################################

- title: Aggregate functions
  tests:

  # Exists, Every, Count
  # (Oracle cannot handle EXISTS and an aggregate in the same SELECT clause)
  - uri: /course?department='lang'
  - uri: /{exists(course?department='lang'),
           every(course?department='lang'),
           count(course?department='lang')}
    ifndef: oracle
  - uri: /{exists(course?department='lang'),
           every(course?department='lang')}
    ifdef: oracle
  - uri: /{count(course?department='lang')}
    ifdef: oracle
  # Applied to an empty set
  - uri: /course?department='str'
  - uri: /{exists(course?department='str'),
           every(course?department='str'),
           count(course?department='str')}
    ifndef: oracle
  # Applied to all-TRUE, all-FALSE, mixed sets
  - uri: /course{department,no,credits,credits>3}
                ?department={'me','mth','phys'}
  - uri: /{exists(course{credits>3}?department='me'),
           every(course{credits>3}?department='me'),
           count(course{credits>3}?department='me')}
    ifndef: oracle
  - uri: /{exists(course{credits>3}?department='mth'),
           every(course{credits>3}?department='mth'),
           count(course{credits>3}?department='mth')}
    ifndef: oracle
  - uri: /{exists(course{credits>3}?department='phys'),
           every(course{credits>3}?department='phys'),
           count(course{credits>3}?department='phys')}
    ifndef: oracle
  # Coercion
  - uri: /department{code,school,boolean(school)}
  - uri: /{exists(department{school}),
           every(department{school}),
           count(department{school})}
    ifndef: oracle
  # Singular operand
  - uri: /{exists(true())}
    expect: 400
  - uri: /{every(true())}
    expect: 400
  - uri: /{count(true())}
    expect: 400

  # Min, Max
  - uri: /course{no,credits}?department='be'
  - uri: /{min(course{credits}?department='be'),
           max(course{credits}?department='be')}
  # Applied to an empty set
  - uri: /course?department='str'
  - uri: /{min(course{credits}?department='str'),
           max(course{credits}?department='str')}
  # Non-numeric operands
  - uri: /{min(student.dob), max(student.dob)}
  - uri: /{min(student.name), max(student.name)}
  # Inadmissible operand
  - uri: /{min(student.is_active), max(student.is_active)}
    expect: 400

  # Sum, Avg
  - uri: /{sum(course{credits}?department='be'),
           count(course{credits}?department='be'),
           avg(course{credits}?department='be')}
  # Applied to an empty set
  - uri: /{sum(course{credits}?department='str'),
           count(course{credits}?department='str'),
           avg(course{credits}?department='str')}
  # Inadmissible operands
  - uri: /{sum(student.dob)}
    expect: 400
  - uri: /{avg(student.name)}
    expect: 400

########################################################################

- title: Table functions and operators
  tests:

  # Joining
  # 1 - N
  - uri: /school.program
  - uri: /school.department
  # N - 1
  - uri: /program.school
  - uri: /department.school
  # 1 - 1
  - uri: /instructor.confidential
  - uri: /confidential.instructor
  # Cross join
  - uri: /school.fiber(school)
  # Fiber join
  - uri: /department.fiber(program,school)
  - uri: /classification.fiber(classification,code,part_of)
            {part_of, code}
  # Context
  - uri: /school.fiber(school){root().school.code, this().code}
  # Invalid link
  - uri: /student.instructor
    expect: 400

  # Filtering
  - uri: /school?code='mus'
  - uri: /student?!is_active
  # Coercion
  - uri: /department?school

  # Sorting
  - uri: /department.sort(name)
  - uri: /department.sort(name+)
  - uri: /department.sort(name-)
  # NULL
  - uri: /department.sort(school+)
  - uri: /department.sort(school-)
  # Combined with joining
  - uri: /school.department.sort(code+)
  - uri: /school.sort(code+).department.sort(code+)
  # Multiple arguments
  - uri: /course.sort(credits-,no+)?department='stdart'

  # Limiting
  - uri: /course.limit(9)
  - uri: /course.limit(3,6)
  # Combined with sort
  - uri: /course.sort(credits+).limit(9)
  - uri: /course.limit(9).sort(credits+)
  - uri: /course.sort(credits-).limit(9).sort(no-)

  # Selecting
  - uri: /school{name}
  - uri: /department{school.name, name}
  - uri: /school{*}
  - uri: /department{school.*, *}

########################################################################

- title: Decorators
  tests:

  # AS decorator
  - uri: /(school :as 'List of Schools')
  - uri: /school{name :as Name}
  - uri: /(school :as 'List of Schools')
            {name :as Name, count(department) :as '# of Departments'}

  # Direction decorator
  - uri: /school{name+}
  - uri: /course{credits-, no+, title}?department='stdart'

